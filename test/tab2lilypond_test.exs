defmodule Tab2lilypondTest do
  use ExUnit.Case

  test "Ode to joy, part 1" do
    tab = """
          e|-------------------------------|
          B|-5-5-6-8-8-6-5-3-1-1-3-5-5-3-3-|
          G|-------------------------------|
          D|-------------------------------|
          A|-------------------------------|
          E|-------------------------------|
          """
    expected = ~S"\relative { e''8 e f g g f e d c c d e e d d }"
    assert Tab2lilypond.parse(tab) == expected
  end
  test "Ode to joy, part 2" do
    tab = """
          e|-------------------------------|
          B|-5-5-6-8-8-6-5-3-1-1-3-5-3-1-1-|
          G|-------------------------------|
          D|-------------------------------|
          A|-------------------------------|
          E|-------------------------------|
          """
    expected = ~S"\relative { e''8 e f g g f e d c c d e d c c }"
    assert Tab2lilypond.parse(tab) == expected
  end
  test "Stairway to Heaven" do
    tab = """
          e|-------5-7-----7-8-----8-2-----2-0-------0-0-----------|
          B|-----5-----5-------5-------3-------1---1-----1---0-1-1-|
          G|---5---------5-------5-------2-------2---------2-------|
          D|-7-----------------------------------------------------|
          A|-------------------------------------------------------|
          E|-------------------------------------------------------|
          """
    expected = ~S"\relative { a'8 c e a b e, c b' c e, c c' fis, d a fis' e c a c e e c a b c c }"
    assert Tab2lilypond.parse(tab) == expected
  end

test "Stairway to Heaven (multiple strings)" do
  tab = """
        ​e|-------5-7-----7-|
        ​B|-----5-----5-----|
        ​G|---5---------5---|
        ​D|-7-------6-------|
        ​A|-----------------|
        ​E|-----------------|
        """
   expected = ~S"\relative { a'8 c e a << b gis, >> e' c b' }"
   assert Tab2lilypond.parse(tab) == expected
  end
  test "Stairway to Heaven (silences and divisions)" do
    tab = """
          ​e|-------5-7-----7-|-8-----8-2-----2-|-0---------0-----|-----------------|
          ​B|-----5-----5-----|---5-------3-----|---1---1-----1---|-0-1-1-----------|
          ​G|---5---------5---|-----5-------2---|-----2---------2-|-0-2-2---2-------|
          ​D|-7-------6-------|-5-------4-------|-3---------------|-----------------|
          ​A|-----------------|-----------------|-----------------|-2-0-0---0---8-7-|
          ​E|-----------------|-----------------|-----------------|-----------------|
          """
     expected = ~S"\relative { a'8 c e a << b gis, >> e' c b' | << c g, >> e' c c' << fis, fis, >> d' a fis' | << e f, >> c' a c r e c a | << b g b, >> << c' a a, >> << c' a a, >> r << a' a, >> r f' e }"
     assert Tab2lilypond.parse(tab) == expected
   end
   test "Stairway to Heaven (multiple segments)" do
    tab = """
          e|-------5-7-----7-|-8-----8-2-----2-|-0---------0-----|-----------------|
          B|-----5-----5-----|---5-------3-----|---1---1-----1---|-0-1-1-----------|
          G|---5---------5---|-----5-------2---|-----2---------2-|-0-2-2---2-------|
          D|-7-------6-------|-5-------4-------|-3---------------|-----------------|
          A|-----------------|-----------------|-----------------|-2-0-0---0---8-7-|
          E|-----------------|-----------------|-----------------|-----------------|

          e|---------7-----7-|-8-----8-2-----2-|-0---------0-----|-----------------|
          B|-------5---5-----|---5-------3-----|---1---1-----1---|-0-1-1-----------|
          G|-----5-------5---|-----5-------2---|-----2---------2-|-0-2-2-----------|
          D|---7-----6-------|-5-------4-------|-3---------------|-----------------|
          A|-0---------------|-----------------|-----------------|-2-0-0-------0-2-|
          E|-----------------|-----------------|-----------------|-----------------|
          """

      expected = [
        ~S"\relative { a'8 c e a << b gis, >> e' c b' | << c g, >> e' c c' << fis, fis, >> d' a fis' | << e f, >> c' a c r e c a | << b g b, >> << c' a a, >> << c' a a, >> r << a' a, >> r f' e }",
        ~S"\relative { a8 a' c e << b' gis, >> e' c b' | << c g, >> e' c c' << fis, fis, >> d' a fis' | << e f, >> c' a c r e c a | << b g b, >> << c' a a, >> << c' a a, >> r r r a b }"
      ]
     assert Tab2lilypond.parse(tab) |> String.split("\n") == expected
   end

   test "Stairway to Heaven (ornaments)" do
    tab = """
          e|-------5-7-----7-|-8-----8-2-----2-|-0---------0-----|-----------------|
          B|-----5-----5-----|---5-------3-----|---1---1-----1---|-0-1-1-----------|
          G|---5---------5---|-----5-------2---|-----2---------2-|-0-2-2---2-------|
          D|-7-------6-------|-5-------4-------|-3---------------|-----------------|
          A|-----------------|-----------------|-----------------|-2-0-0---0---8-7-|
          E|-----------------|-----------------|-----------------|-----------------|

          e|---------7-----7-|-8-----8-2-----2-|-0---------0-----|-----------------|
          B|-------5---5-----|---5-------3-----|---1---1-----1---|-0-1-1-----------|
          G|-----5-------5---|-----5-------2---|-----2---------2-|-0-2-2-----------|
          D|---7-----6-------|-5-------4-------|-3---------------|-----------------|
          A|-0---------------|-----------------|-----------------|-2-0-0-------0-2-|
          E|-----------------|-----------------|-----------------|-----------------|

          e|-------0-2-----2-|-0-----0-----------|---------3-----3-|-3p2-2-2-----------|
          B|-----------3-----|---1-----0h1-------|-1-----1---0-----|-----3-3-----------|
          G|-----0-------2---|-----2-------2-----|---0---------0---|-----2-2-----------|
          D|---2-----0-------|-3-----------------|-----2-----------|-0---0-0-----------|
          A|-3---------------|---------0-----0-2-|-3---------------|---------------0-2-|
          E|-----------------|-------------------|---------3-------|-------------------|

          e|---------2-----2-|-0-----0-----------|---------------2-|-0-0-0-----------|
          B|-------1---3-----|---1-----0h1-------|-------1-----3---|-1-1-1-----------|
          G|-----0-------2---|-----2-------2-----|-----0-----2-----|-2-2-2-----------|
          D|---2-----0-------|-3-----------------|---2-----0-------|-3-3-3-----------|
          A|-3---------------|---------0-----0-2-|-3---------------|-----------------|
          E|-----------------|-------------------|-----------------|-----------------|
          """

      expected = [
        ~S"\relative { a'8 c e a << b gis, >> e' c b' | << c g, >> e' c c' << fis, fis, >> d' a fis' | << e f, >> c' a c r e c a | << b g b, >> << c' a a, >> << c' a a, >> r << a' a, >> r f' e }",
        ~S"\relative { a8 a' c e << b' gis, >> e' c b' | << c g, >> e' c c' << fis, fis, >> d' a fis' | << e f, >> c' a c r e c a | << b g b, >> << c' a a, >> << c' a a, >> r r r a b }",
        ~S"\relative { c'8 e g e' << fis d, >> d' a fis' | << e f, >> c' a e' << grace b16 c8 a, >> a' a, b | << c' c, >> g' e c' << g' g, >> b' g g' | << grace g16 fis8 d, >> << fis' d a d, >> << fis' d a d, >> r r r a b }",
        ~S"\relative { c'8 e g c << fis d, >> d' a fis' | << e f, >> c' a e' << grace b16 c8 a, >> a' a, b | c e g c d, a' d fis | << e c a f >> << e' c a f >> << e' c a f >> r r r r r }"
      ]
     assert Tab2lilypond.parse(tab) |> String.split("\n") == expected
   end
end
